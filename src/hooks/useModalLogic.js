import { useState } from 'react';\nimport { storage } from '../utils/storage';\nimport { analytics } from '../utils/analytics';\nimport { getRecommendedProduct } from '../data/coupangProducts';\nimport { rankingService } from '../services/rankingService';\n\n// ëª¨ë‹¬ ë° ì‚¬ìš©ì ì•¡ì…˜ ê´€ë¦¬ í›…\nexport const useModalLogic = ({\n  elapsedTime,\n  adClicks,\n  setAdClicks,\n  totalTimeWasted,\n  visits,\n  isRankingInitialized,\n  currentUser\n}) => {\n  const [showModal, setShowModal] = useState(false);\n  const [modalConfig, setModalConfig] = useState({});\n  const [showRankingModal, setShowRankingModal] = useState(false);\n\n  // ì„¸ë ¨ëœ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜\n  const showModernModal = (title, message, type = 'info', showCancel = false) => {\n    setModalConfig({ title, message, type, showCancel });\n    setShowModal(true);\n  };\n\n  // í™œë™ ì„ íƒ í•¸ë“¤ëŸ¬\n  const handleActivitySelect = (activity) => {\n    console.log('ğŸ¯ ì‚¬ìš©ìê°€ í™œë™ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤:', activity);\n    \n    if (activity === 'start_activity') {\n      showModernModal(\n        'ğŸš€ ëŒ€ë‹¨í•´ìš”!',\n        'ë“œë””ì–´ ìƒì‚°ì ì¸ ì¼ì„ ì‹œì‘í•˜ì‹œëŠ”êµ°ìš”! ì´ ì˜ì§€ë¥¼ ê³„ì† ìœ ì§€í•´ë³´ì„¸ìš”. ì•„ë‹ˆë©´... ì¡°ê¸ˆ ë” ì—¬ê¸° ìˆì–´ë„ ê´œì°®ì•„ìš” ğŸ˜',\n        'success'\n      );\n    } else {\n      showModernModal(\n        'âœ¨ í›Œë¥­í•œ ì„ íƒ!',\n        `\"${activity}\" ì •ë§ ì¢‹ì€ ì•„ì´ë””ì–´ë„¤ìš”! ì§€ê¸ˆ ë‹¹ì¥ ì‹œì‘í•´ë³´ì„¸ìš”. ë” ëŠ¦ê¸° ì „ì— ë§ì´ì—ìš”...`,\n        'info'\n      );\n      \n      analytics.trackActivitySelect(activity, elapsedTime);\n    }\n  };\n\n  // ì¿ íŒ¡ ìƒí’ˆ í´ë¦­\n  const handleProductClick = () => {\n    const product = getRecommendedProduct(elapsedTime);\n    \n    analytics.trackCoupangClick(product.name, product.category, elapsedTime, adClicks + 1);\n    \n    window.open(product.url, '_blank');\n    \n    const responses = [\n      `${product.icon} ${product.name} ì¢‹ì€ ì„ íƒì´ì—ìš”! ğŸ‰`,\n      `í›Œë¥­í•´ìš”! ${product.category} ë¶„ì•¼ íˆ¬ìëŠ” ì–¸ì œë‚˜ ì˜³ìŠµë‹ˆë‹¤!`,\n      `${product.name}ë¡œ ì‹œê°„ë‚­ë¹„ë¥¼ ìƒì‚°ì ìœ¼ë¡œ ë§Œë“œì…¨ë„¤ìš”!`,\n      `ê°ì‚¬í•©ë‹ˆë‹¤! ${product.category} ìƒí’ˆ í´ë¦­ìœ¼ë¡œ ì‚¬ì´íŠ¸ë¥¼ í›„ì›í•´ì£¼ì…¨ì–´ìš”!`,\n      `ì™„ë²½í•œ ì„ íƒ! ${product.name}ì€ ì •ë§ ì¶”ì²œí•˜ëŠ” ì•„ì´í…œì´ì—ìš”!`\n    ];\n    \n    const randomResponse = responses[Math.floor(Math.random() * responses.length)];\n    showModernModal(\"ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í´ë¦­!\", randomResponse, 'success');\n    \n    const newAdClicks = storage.incrementAdClicks();\n    setAdClicks(newAdClicks);\n  };\n\n  // ì¢…ë£Œ í™•ì¸\n  const handleExit = () => {\n    setShowRankingModal(true);\n  };\n\n  const handleRankingModalClose = () => {\n    setShowRankingModal(false);\n    showModernModal(\n      \"í˜„ì‹¤ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?\",\n      \"ì •ë§ë¡œ ì´ í™˜ìƒì ì¸ ì‹œê°„ë‚­ë¹„ë¥¼ ëë‚´ì‹œê² ìŠµë‹ˆê¹Œ? ì§€ê¸ˆê¹Œì§€ì˜ ëª¨ë“  ë…¸ë ¥ì´ ë¬¼ê±°í’ˆì´ ë  ìˆ˜ ìˆì–´ìš”!\",\n      'exit',\n      true\n    );\n  };\n\n  const confirmExit = () => {\n    analytics.trackExit(elapsedTime);\n    storage.updateTotalTimeWasted(elapsedTime);\n    \n    setShowModal(false);\n    setShowRankingModal(false);\n    \n    if (isRankingInitialized) {\n      rankingService.endSession();\n    }\n    \n    window.removeEventListener('beforeunload', handleBeforeUnload);\n    \n    setTimeout(() => {\n      if (window.history.length > 1) {\n        window.history.back();\n      } else {\n        window.location.reload();\n      }\n    }, 100);\n  };\n\n  return {\n    // ìƒíƒœë“¤\n    showModal,\n    modalConfig,\n    showRankingModal,\n    \n    // í•¨ìˆ˜ë“¤\n    showModernModal,\n    handleActivitySelect,\n    handleProductClick,\n    handleExit,\n    handleRankingModalClose,\n    confirmExit,\n    \n    // ì„¸í„°ë“¤\n    setShowModal,\n    setShowRankingModal\n  };\n};\n